name: AI Paper Review

# ‼️ 关键修复 1: 添加 'permissions'
# 这是为了允许 Action 读取文件并写评论到 Pull Request
permissions:
  pull-requests: write
  contents: read

# ‼️ 关键修复 2: 更改触发器
# 这个 Action 是为 "Pull Request" 设计的。
# 它会在你创建 PR 或更新 PR 时运行。
on:
  pull_request:
    paths:
      - '**.tex'
      - '**.md'
      - '**.pdf'
    types: [opened, synchronize, reopened]
  
  # 也允许你手动运行
  workflow_dispatch:

jobs:
  review:
    runs-on: ubuntu-latest

    # ‼️ 关键修复 3: 移除了整个 job-level 'env: REPO:' 块
    # (这个新 Action 不需要它)

    steps:
      # 1️⃣ 拉取仓库文件
      - name: Checkout Repository
        uses: actions/checkout@v3
        # 需要获取 PR 的完整历史记录
        with:
          fetch-depth: 0 

      # ‼️ 关键修复 4: 移除了 "Debug" 步骤 (不再需要)

      # 2️⃣ 调用 Gemini 2.5 Pro 进行 AI 审稿
      - name: Run AI Academic Paper Reviewer
        # ‼️ 关键修复 5: 使用教程中正确的、稳定的 Action
        uses: toshi0806/ai-academic-paper-reviewer@v1 
        with:
          # 这个 Action 不需要 REPO 变量
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          # 确保这指向您在 GitHub Secrets 中的 Key (您的是 GOOGLE_API_KEY)
          GEMINI_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          
          # --- 以下是您的个人设置 ---
          MODEL_CODE: "gemini-2.5-pro"
          LANGUAGE: "Chinese"
          
          # ‼️ 关键修复 6: 使用教程中的 "ACADEMIC" (大写)
          REVIEW_MODE: "ACADEMIC"
          
          # 注意： "USE_SINGLE_COMMENT_REVIEW" 似乎是 smkwlab 版本的功能
          # v1 版本默认会将所有评论合并为一个，所以我们移除了这个选项。
          EXCLUDE_PATHS: ""
